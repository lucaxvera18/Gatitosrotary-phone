<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Para la más linda ❤️</title>
<style>
  html,body {
    margin: 0;
    height: 100%;
    background: #000;
    overflow: hidden;
  }
  canvas {
    display: block;
    width: 100vw;
    height: 100vh;
    image-rendering: pixelated;
  }
  @import url('https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap');
</style>
</head>
<body>
<canvas id="c"></canvas>
<script>
const canvas = document.getElementById("c");
const ctx = canvas.getContext("2d");
let W, H;
let firework;

function resize() {
  W = canvas.width = window.innerWidth;
  H = canvas.height = window.innerHeight;
}
window.onresize = resize;
resize();

// Estrellas
const stars = [...Array(300)].map(() => ({
  x: Math.random() * W,
  y: Math.random() * H,
  s: Math.random() < 0.7 ? 1 : 2,
  alpha: 0.5 + Math.random() * 0.5 // Alfa inicial para un parpadeo más natural
}));

// Gatos
function drawCat(x, y, flip = false) {
  ctx.save();
  ctx.translate(x, y);
  if (flip) ctx.scale(-1, 1);
  
  // Cuerpo del gato (más estilizado)
  ctx.fillStyle = "white";
  ctx.beginPath();
  ctx.ellipse(0, 30, 25, 35, 0, 0, Math.PI * 2);
  ctx.fill();
  
  // Cabeza
  ctx.beginPath();
  ctx.arc(0, 0, 30, 0, Math.PI * 2);
  ctx.fill();
  
  // Orejas
  ctx.fillStyle = "pink";
  ctx.beginPath();
  ctx.moveTo(-20, -10);
  ctx.lineTo(-40, -40);
  ctx.lineTo(-5, -20);
  ctx.fill();
  ctx.beginPath();
  ctx.moveTo(20, -10);
  ctx.lineTo(40, -40);
  ctx.lineTo(5, -20);
  ctx.fill();
  
  // Nariz y ojos (detalles)
  ctx.fillStyle = "black";
  ctx.beginPath();
  ctx.arc(-12, -5, 3, 0, Math.PI * 2); // Ojo izquierdo
  ctx.fill();
  ctx.beginPath();
  ctx.arc(12, -5, 3, 0, Math.PI * 2); // Ojo derecho
  ctx.fill();
  ctx.beginPath();
  ctx.arc(0, 5, 2, 0, Math.PI * 2); // Nariz
  ctx.fill();
  
  ctx.restore();
}

// Fuegos artificiales
const message = "Para la más linda ❤️";
const colors = ["#ff2d2d", "#ff7f00", "#ffff3d", "#3dff4a", "#2dbbff", "#ff2dfd"];
let nextFireworkTime = 0;
const fireworkInterval = 10000; // 10 segundos

function createFirework() {
  firework = {
    x: W / 2,
    y: H,
    vy: -10, // Velocidad inicial del cohete más rápida
    explode: false,
    particles: [],
    sparks: [],
    done: false
  };
}

function createTextParticles() {
  const off = document.createElement("canvas");
  const octx = off.getContext("2d");
  off.width = W;
  off.height = H;
  
  // Posición del texto en el canvas de memoria
  const textY = H / 2.5;

  octx.fillStyle = "white";
  octx.font = `bold ${Math.floor(H / 10)}px "Press Start 2P", "Courier New", monospace`;
  octx.textAlign = "center";
  octx.textBaseline = "middle";
  octx.fillText(message, off.width / 2, textY);

  const d = octx.getImageData(0, 0, off.width, off.height).data;
  const pts = [];
  // Muestreo para una mejor densidad de texto
  for (let y = 0; y < off.height; y += 3) {
    for (let x = 0; x < off.width; x += 3) {
      if (d[(y * off.width + x) * 4 + 3] > 128) {
        pts.push({ x, y });
      }
    }
  }

  firework.particles = pts.map(p => ({
    x: firework.x,
    y: firework.y,
    tx: p.x,
    ty: p.y,
    vx: (Math.random() - 0.5) * 15, // Velocidad inicial más alta
    vy: (Math.random() - 0.5) * 15,
    life: 0,
    trail: [] // Rastro de la partícula
  }));

  firework.sparks = [...Array(200)].map(() => ({
    x: firework.x,
    y: firework.y,
    vx: (Math.random() - 0.5) * 20, // Velocidad inicial más alta
    vy: (Math.random() - 0.5) * 20,
    color: colors[Math.floor(Math.random() * colors.length)],
    life: 80 + Math.random() * 60
  }));
}

// Animación
function loop(time) {
  // Limpieza del canvas con un rastro sutil
  ctx.fillStyle = "rgba(0, 0, 0, 0.1)";
  ctx.fillRect(0, 0, W, H);

  // Estrellas (parpadeo)
  ctx.fillStyle = "white";
  for (const s of stars) {
    s.alpha += (Math.random() - 0.5) * 0.1;
    s.alpha = Math.max(0.5, Math.min(1, s.alpha)); // Mantener alfa en un rango
    ctx.globalAlpha = s.alpha;
    ctx.fillRect(s.x, s.y, s.s, s.s);
  }
  ctx.globalAlpha = 1;

  // Gatos
  drawCat(80, H - 120, false);
  drawCat(W - 80, H - 120, true);

  // Fuegos artificiales
  if (firework) {
    if (!firework.explode) {
      // Cohete subiendo
      ctx.fillStyle = "pink";
      ctx.fillRect(firework.x - 2, firework.y - 10, 4, 10);
      firework.y += firework.vy;
      if (firework.y < H / 2.5) {
        firework.explode = true;
        createTextParticles();
      }
    } else {
      // Partículas del texto y chispas
      let allDone = true;
      for (const p of firework.particles) {
        p.life++;
        if (p.life > 100) continue; // Desaparecen después de un tiempo

        // Atracción hacia la posición final
        p.vx += (p.tx - p.x) * 0.005;
        p.vy += (p.ty - p.y) * 0.005;
        p.x += p.vx;
        p.y += p.vy;
        
        // Rastro
        p.trail.push({x: p.x, y: p.y});
        if (p.trail.length > 5) p.trail.shift();

        // Dibujo del rastro
        for (let i = 0; i < p.trail.length; i++) {
            const pos = p.trail[i];
            const trailAlpha = (i + 1) / p.trail.length;
            ctx.fillStyle = `rgba(255, 105, 180, ${trailAlpha})`;
            const size = Math.max(0, 4 - p.life * 0.05);
            ctx.fillRect(pos.x, pos.y, size, size);
        }
        allDone = false;
      }
      
      for (const s of firework.sparks) {
        if (s.life > 0) {
          s.life--;
          s.x += s.vx;
          s.y += s.vy;
          s.vy += 0.1; // Gravedad un poco más fuerte
          ctx.fillStyle = s.color;
          ctx.globalAlpha = s.life / 60; // Desvanecimiento
          const sparkSize = Math.max(0, s.life * 0.05);
          ctx.fillRect(s.x, s.y, sparkSize, sparkSize);
          allDone = false;
        }
      }
      if (allDone) {
        firework = null;
      }
    }
  }

  // Controla el intervalo del próximo fuego artificial
  if (!firework && time > nextFireworkTime) {
    createFirework();
    nextFireworkTime = time + fireworkInterval;
  }

  requestAnimationFrame(loop);
}

// Inicia la animación
createFirework();
requestAnimationFrame(loop);
</script>
</body>
</html>
